@{
    ViewBag.Title = "Calendar";
}

<div class="row-fluid">
    <div class="span8">
        <div id="calendar">
            <!--Full Calendar gets entered here-->
        </div>
    </div>
    <div class="span4" id="toolbar">
        <p class="text-center"><button id="createInterview"><i class="fa fa-plus"></i> Create Interview</button></p>
        <!-- Create new interview collapsable panel-->
        <div class="panel panel-primary" style="display:none" id="showCreate">
            <div class="panel-heading">
                <h4 class="panel-title">Create New Interview</h4>
            </div>
            <div class="panel-body">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label for="scheduledDate" class="control-label span3">Date</label>
                        <div class="span7">
                            <input type="text" class="form-control span11" name="scheduledDate" id="scheduledDate" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="startTime" class="control-label span3">Start Time</label>
                        <div class="span3">
                            <input type="time" class="form-control span11" name="startTime" id="startTime" />
                        </div>
                        <label for="endTime" class="control-label span3">End Time</label>
                        <div class="span3">
                            <input type="time" class="form-control span11" name="endTime" id="endTime" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="candidate" class="control-label span3">Candidate</label>
                        <div class="span7">
                            <input type="text" class="form-control span11" name="candidate" id="candidate" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="interviewer" class="control-label span3">Interviewer</label>
                        <div class="span7">
                            <input type="text" class="form-control span11" name="interviewer" id="interviewer" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="room" class="control-label span3">Room</label>
                        <div class="span7">
                            <input type="text" class="form-control span11" name="room" id="room" />
                        </div>
                    </div>
                </form>
                <p class="text-center">
                    <button type="button" class="btn-ignore btn-success"><i class="fa fa-check"></i> Schedule</button>
                    <button type="button" class="btn-ignore btn-danger" id="cancelInterview"><i class="fa fa-times-circle"></i> Cancel</button>
                </p>
            </div>
        </div>
        <!-- Interview information panel -->
        <div class="panel panel-primary hide" id="interview-info">
            <div class="panel-heading">
                <h4 class="panel-title">Interview Info</h4>
            </div>
            <div class="panel-body">
                <b>Date: </b><span id="interview-info-date"></span><br />
                <b>Time: </b><span id="interview-info-time"></span><br />
                <b>Location: </b><span id="interview-info-location"></span><br />
                <b>Interviewers: </b><span id="interview-info-interviewers"></span><br />
                <b>Candidates: </b><span id="interview-info-candidates"></span><br />
                <p class="text-center">
                    <button type="button"><i class="fa fa-edit"></i> Edit</button>
                    <a type="button" class="button" href="@Url.Action("Comments", "Interviews")"><i class="fa fa-comment"></i> Comments</a>
                    <button type="button" class="btn-ignore btn-danger"><i class="fa fa-times"></i> Delete</button>
                </p>
                <p class="text-center">
                    <button type="button" id="hide-interview-info" class="btn-ignore btn-danger">Close Info</button>
                </p>
            </div>
        </div>
    </div>
</div>

@section AddToScripts {
    <script type="text/javascript">
        $(document).ready(function () {

            /*
            // Sample for odata
            var obj = {
                "$filter": "Date gt datetime'2014-05-01' and Date lt datetime'2014-05-31'"
            };
            console.log($.param(obj));
            $.ajax({
                url: "http://localhost:50741/api/Interview/GetBy?" + $.param(obj),
                type: "Get",
                success: function (data) {
                    console.log("success");
                    console.log(data);
                },
                error: function (data) {
                    console.log("error");
                    console.log(data);
                    console.log(data.responseText);
                }
            });
            */

            $("#calendar").fullCalendar({
                header: {
                    left: "prev,next today",
                    center: "title",
                    right: "month,agendaWeek,agendaDay"
                },
                weekMode: "liquid",
                buttonText: {
                    today: "Today",
                    month: "Month",
                    week: "Week",
                    day: "Day"
                },
                selectable: true,
                eventColor: "#17599D",
                viewRender: function(view, element) {
                    var start = view.start;
                    var end = view.end;
                    console.log(start.toISOString());
                    console.log(end.toISOString());
                    //Remove all events
                    $("#calendar").fullCalendar("removeEvents");
                    //Fetch events from API
                    var obj = {
                        "$filter": "Date gt datetime'" + start.toISOString() + "' and Date lt datetime'" +
                            end.toISOString() + "'"
                    };
                    console.log($.param(obj));
                    $.ajax({
                        url: "http://localhost:50741/api/Interview/GetBy?" + $.param(obj),
                        type: "Get",
                        success: function (data) {
                            console.log("success");
                            for (var i = 0; i < data.length; i++) {
                                var interview = data[i];
                                console.log(interview.StartTime);
                                console.log(interview.EndTime);
                                var event = {
                                    id: interview.InterviewID,
                                    //TODO: change this title to something else? or to icon?
                                    title: "Interview",
                                    allDay: false,
                                    start: interview.StartTime,
                                    end: interview.EndTime
                                };
                                $("#calendar").fullCalendar("renderEvent", event);
                            }
                        },
                        error: function (data) {
                            console.log("error");
                            console.log(data);
                            console.log(data.responseText);
                        }
                    });
                },
                dayClick: function (date, allDay, jsEvent, view) {
                    var myDate = $("#calendar").fullCalendar('getDate');
                    //alert("The current date of the calendar is " + myDate);
                    $("#scheduledDate").datepicker("setDate", date);
                },
                eventClick: function (event, jsEvent, view) {
                    var id = event.id;
                    console.log(id);
                    // Get interview from API
                    $.ajax({
                        url: "http://localhost:50741/api/Interview/Get/" + id,
                        type: "Get",
                        success: function (data) {
                            console.log("success");
                            // Display information in sidebar

                            // Show sidebar at end
                            $("#interview-info").removeClass("hide");
                        },
                        error: function (data) {
                            console.log("error");
                            console.log(data);
                            console.log(data.responseText);
                        }
                    });
                }

            });

            var sampleEvent = {
                title: "Interview 1",
                start: "2014-02-10T13:15:30Z"
            };

            var sampleEvent2 = {
                title: "Interview 2",
                start: "2014-02-07T13:15:30Z",
                backgroundColor: "#F2F21B",
                borderColor: "#F2F21B",
                textColor: "#000000"
            };

            //$("#calendar").fullCalendar("renderEvent", sampleEvent, true);
            //$("#calendar").fullCalendar("renderEvent", sampleEvent2, true);

            $("#createInterview").click(function () {
                $("#showCreate").slideToggle();
            });

            $("#cancelInterview").click(function () {
                $("#showCreate").slideToggle();
                $("#room").val('');
                $("#startTime").val('');
                $("#endTime").val('');
            });

            $("#hide-interview-info").click(function () {
                $("#interview-info").addClass("hide");
            });

            $("#scheduledDate").datepicker();

            /*
            $("#candidate").select2(
                {
                    minimumInputLength: 3,
                    placeholder: 'Enter name',
                    ajax: {
                        url: "http://www.weighttraining.com/sm/search",
                        dataType: 'jsonp',
                        quietMillis: 100,
                        data: function (term, page) {
                            return {
                                types: ["exercise"],
                                limit: -1,
                                term: term
                            };
                        },
                        results: function (data, page) {
                            return { results: data.results.exercise }
                        }
                    },
                    formatResult: function (exercise) {
                        return "<div class='select2-user-result'>" + exercise.term + "</div>";
                    },
                    formatSelection: function (exercise) {
                        return exercise.term;
                    },
                    initSelection: function (element, callback) {
                        var elementText = $(element).attr('data-init-text');
                        callback({ "term": elementText });
                    }
                });

            $("#interviewer").select2(
                {
                    placeholder: 'Enter name',
                    minimumInputLength: 1,
                    allowClear: true,
                    quietMillis: 100
                });
                */

        });
    </script>
}